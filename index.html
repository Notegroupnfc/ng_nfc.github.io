<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>NFC Redirect</title>
</head>
<body>
  <h3>Đang xử lý NFC...</h3>
  <script>
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");
    const source = params.get("source") || "web";

    if (!id) {
      document.body.innerHTML = "Thiếu ID NFC";
    } else {
      // Gọi Web App để ghi log
      const webAppUrl = "https://script.google.com/macros/s/AKfycbwc4LypYX5Fka-6F2xiK07wS7K4Bk-GaMGmBKltM8QyuXYWwaj1rPn_0Vpt1cZ__dPq/exec?id=" 
                          + encodeURIComponent(id)
                          + "&source=" + encodeURIComponent(source);

      fetch(webAppUrl)
        .then(res => res.text())
        .then(link => {
          // Mở link trực tiếp 1 lần, tránh reload
          window.location.href = link.trim();
        })
        .catch(err => {
          document.body.innerHTML = "Lỗi ghi log: " + err;
        });
    }
  </script>
</body>
</html>

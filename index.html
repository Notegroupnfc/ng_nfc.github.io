function doGet(e){
  try{
    let p={};
    if(e && e.parameter){ p=e.parameter; }

    if(p.source!=="nfc"){
      return ContentService.createTextOutput("IGNORE").setMimeType(ContentService.MimeType.TEXT);
    }

    const ss = SpreadsheetApp.getActiveSpreadsheet();
    let sheet = ss.getSheetByName("LOG_NFC");
    if(!sheet){
      sheet = ss.insertSheet("LOG_NFC");
      sheet.appendRow(["ID","THOI_GIAN","TEN_TOA_NHA","LINKS"]);
    }

    const thoiGianVn = Utilities.formatDate(new Date(),"GMT+7","dd/MM/yyyy HH:mm:ss");

    sheet.appendRow([
      p.id || "N/A",
      thoiGianVn,
      p.toa_nha || "N/A",
      p.links || "N/A"
    ]);

    return ContentService.createTextOutput("LOG_NFC_OK").setMimeType(ContentService.MimeType.TEXT);
  }catch(err){
    Logger.log(err);
    return ContentService.createTextOutput("ERROR: "+err.toString());
  }
}

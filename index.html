<!DOCTYPE html>
<html lang="vi">
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <script src="cdnjs.cloudflare.com"></script>
  <style>
    body { font-family: sans-serif; display: flex; justify-content: center; padding: 20px; }
    .container { border: 1px solid #ccc; padding: 20px; border-radius: 8px; width: 300px; }
    input { margin: 10px 0; width: 100%; }
    button { width: 100%; padding: 10px; background: #007bff; color: white; border: none; cursor: pointer; }
    #msg { margin-top: 10px; font-size: 13px; }
  </style>
</head>
<body>
  <div class="container">
    <h3>Tải lên data.csv</h3>
    <input type="file" id="csvFile" accept=".csv">
    <button onclick="uploadFile()">Ghi vào Nhật ký</button>
    <div id="msg"></div>
  </div>

  <script>
    function uploadFile() {
      const fileInput = document.getElementById('csvFile');
      const msg = document.getElementById('msg');
      if (fileInput.files.length === 0) {
        msg.innerText = "Vui lòng chọn file data.csv!";
        return;
      }
      msg.innerText = "Đang xử lý...";
      const file = fileInput.files;

      Papa.parse(file, {
        header: true,
        skipEmptyLines: true,
        complete: function(results) {
          // Gửi mảng dữ liệu đã parse lên Google Apps Script
          google.script.run
            .withSuccessHandler((res) => {
              msg.innerHTML = "<span style='color:green'>" + res + "</span>";
              fileInput.value = "";
            })
            .withFailureHandler((err) => {
              msg.innerHTML = "<span style='color:red'>Lỗi: " + err + "</span>";
            })
            .processDataFromCSV(results.data); // Gọi hàm trong Code.gs
        }
      });
    }
  </script>
</body>
</html>
